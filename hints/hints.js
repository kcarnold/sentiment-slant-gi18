var hintsData = JSON.parse('[["START", ["I can\'t believe I haven\'t", "I really want to like", "I wish I could remember", "I really want to love"]], ["START", ["My fiance and I went", "I came here with my", "I took my girlfriend here", "My boyfriend and I went", "I went there with my", "My boyfriend took me here"]], ["START", ["I walk by this place"]], ["START", ["I frequent this place for", "I used to frequent this"]], ["EARLY", ["I met a friend here", "We went there for dinner", "I had dinner here last", "I met a friend for"]], ["EARLY", ["We came here on a", "It was a Saturday night", "It was a Friday night"]], ["EARLY", ["There were plenty of empty", "We sat at one of", "We were seated by the", "They have outdoor seating ,", "They have a nice outdoor", "We sat on the patio"]], ["EARLY", ["We had a large group"]], ["EARLY", ["When we arrived we were", "As soon as I walked"]], ["ANY", ["The quality of ingredients is", "The ingredients were fresh and"]], ["ANY", ["If you live in the", "If I lived nearby ,", "There are much better places"]], ["ANY", ["You order at the counter"]], ["ANY", ["They got my order wrong"]], ["ANY", ["The decor was nice ,"]], ["ANY", ["We had a bottle of", "They also serve beer and"]], ["ANY", ["I wanted to order everything", "I want to try everything", "I have been wanting to", "I\'ve been wanting to try", "So I decided to give"]], ["ANY", ["It has just the right", "The flavor was a bit", "You can really taste the", "When they say spicy ,", "It was full of flavor", "All I could taste was", "I asked for some hot"]], ["ANY", ["The portions are very generous"]], ["ANY", ["I also wish they had", "I also wish there was", "One thing I really like", "I usually don\'t like the", "I probably could have eaten", "I want to learn how"]], ["ANY", ["The atmosphere is loud ,", "It can get pretty loud", "The music was a bit"]], ["ANY", ["It\'s fast , cheap ,"]], ["ANY", ["We weren\'t in a rush", "They weren\'t that busy ."]], ["ANY", ["If it weren\'t so close"]], ["ANY", ["For the price you\'re paying", "I don\'t mind paying a", "You definitely get your money\'s", "I guess you get what", "You get what you pay"]], ["ANY", ["I\'m a vegetarian and I", "I\'m not a vegetarian but"]], ["ANY", ["When we finally got our"]], ["ANY", ["I asked if I could", "I asked if they could"]], ["ANY", ["A little on the greasy", "It was a little greasy"]], ["ANY", ["The meat was flavorful and", "The chicken was juicy and"]], ["ANY", ["It was exactly what I"]], ["ANY", ["I actually like this place"]], ["ANY", ["The atmosphere of the place", "The ambiance of the place"]], ["ANY", ["Oh , did I mention", "But hey , at least", "Oh my gosh , I", "Oh yeah , and the"]], ["ANY", ["It\'s a fun place to", "I enjoyed it , but", "We sat outside and enjoyed", "However , I did enjoy", "Overall , I enjoyed my"]], ["ANY", ["They do take credit cards"]], ["ANY", ["If you want a refill"]], ["ANY", ["I am definitely coming back", "I\'ll definitely be back .", "I don\'t think I\'ll be"]], ["ANY", ["The food is horrible and", "The worst part was the", "It\'s not terrible , but", "Not terrible , but not"]], ["ANY", ["I was really impressed by", "I was not impressed by", "I wasn\'t impressed with the"]], ["ANY", ["But if you are hungry", "I have been eating here", "I was still hungry after"]], ["ANY", ["The burritos are pretty good", "The burritos are huge and"]], ["ANY", ["It\'s a bit pricey ,", "It\'s a little pricey for", "A little on the pricey"]], ["ANY", ["I really wanted to like"]], ["ANY", ["You won\'t be disappointed .", "I was disappointed with the", "I have never been disappointed"]], ["ANY", ["I\'ve been here multiple times", "I\'ve only been here twice", "I\'ve been here twice now"]], ["ANY", ["There is plenty of parking", "Parking was easy to find", "Parking is hard to find", "You can park in the", "Parking is on the street", "There is a parking lot"]], ["ANY", ["Overall , it\'s a pretty"]], ["ANY", ["It was bland and boring", "The food is bland ,", "It was a little bland", "The food was bland and", "The food is bland and"]], ["ANY", ["This place has been around", "We\'ve been coming here for", "I\'ve been coming here for"]], ["ANY", ["Everything was good , but"]], ["ANY", ["Staff is friendly and the", "They are very accommodating and"]], ["ANY", ["I was pleasantly surprised to", "I was shocked at how", "I was surprised at how", "I was pleasantly surprised with", "I was pleasantly surprised by"]], ["ANY", ["I am so glad we", "I\'m glad I tried it", "I was very happy with", "I was very pleased with"]], ["ANY", ["It took about 10 minutes", "We were in and out"]], ["ANY", ["The food is simple ,", "The food is flavorful and", "The food was mediocre at"]], ["ANY", ["When I was in college", "When I was a college"]], ["ANY", ["There are so many choices", "There are so many options"]], ["ANY", ["I come here about once", "I eat there at least"]], ["ANY", ["I went there last week"]], ["ANY", ["Good place to chill out", "It was cold and rainy"]], ["ANY", ["I didn\'t know you could"]], ["ANY", ["I couldn\'t really taste the"]], ["ANY", ["I\'ve been to the one"]], ["ANY", ["Wouldn\'t go out of my", "I wouldn\'t recommend going here", "I wouldn\'t recommend this place", "I wouldn\'t go out of"]], ["ANY", ["The prices are pretty reasonable", "The price is very reasonable", "The food is very reasonably", "The drinks are reasonably priced", "The prices are reasonable and", "The prices are reasonable ,"]], ["ANY", ["For the price , I", "However , for the price", "The prices are pretty cheap", "For the price , it\'s", "Prices are a little high"]], ["ANY", ["It wasn\'t amazing , but", "It wasn\'t terrible , but", "I wasn\'t blown away by", "It wasn\'t horrible , but"]], ["ANY", ["I hadn\'t been here in"]], ["ANY", ["It wasn\'t as good as"]], ["ANY", ["Great beer selection , and"]], ["ANY", ["I\'ve eaten at a lot"]], ["ANY", ["I\'ve tried almost everything on", "I\'ve tried a couple of", "I\'ve tried a lot of", "I\'ve tried most of the"]], ["ANY", ["Everything I\'ve tried has been"]], ["ANY", ["The only good thing about", "I used to like this", "I am in love with", "What\'s not to love about", "The best thing about this"]], ["ANY", ["Overall , I really like", "Overall a great place to"]], ["ANY", ["They also have salads ,"]], ["ANY", ["The restaurant is pretty small", "The place is small but", "The place is huge and", "The place is tiny and", "This place is small and", "The space is small and", "The place is really small", "The place is pretty small"]], ["ANY", ["I ordered an iced tea"]], ["END", ["Overall it was a good", "Overall , the experience was", "Probably won\'t be coming back", "I won\'t be going back", "This place is a hit"]], ["END", ["You really can\'t go wrong"]], ["END", ["I will be a regular"]]]');

var examplesData = JSON.parse('["Champaign Chipotle sucks. \\n\\nHonestly, I love Chipotle. I\'ve had it in numerous places, always enjoyed a big juicy burrito, but this one... The worst of the worst. My burrito was half-sized, and most of the ingredients were overhelmed by rice and beans. Barbacoa was tough and dry... Rice was dry too, Corn was pale and weird. Pretty much all of the ingredients tasted different!\\n\\nNever again.", "I used to LOVE Chipotle.  But then they stopped carrying my favorite Nantucket Nectars flavor.  After that, they decreased the portion size of an order of crispy tacos from 4 tacos to 3.\\n\\nOn my last visit, I felt like they gave me even less carnitas on my 3 crispy tacos than I had before.  I\'m sad and I miss the way Chipotle used to be.  If you\'re looking to get full, tacos are not a good choice.  Try the burrito because it comes with lots of rice and beans as fillers.\\n\\nOn a positive note, do drop your business card in the bowl for the weekly drawing.  I won a couple of years ago and everyone in my office got to eat Chipotle for free for lunch.", "What can I say that would be original? It is a chain burrito joint, but NOT owned my McD\'s as some might tell you. It\'s clean, friendly, often built near schools.\\n\\nI\'ve been here probably a 1000 times since they\'ve opened... free burritos on halloween for dressing up in foil is a tradition with my wife and our friends.\\n\\nMy present burrito is: Burrito w/ light rice, beans & fajita veggies, chicken, mild & corn & medium salsa, guac, lettuce. I like the cheese, but I\'m lactose intolerant. \\n\\nBTW, Students get free fountain drinks!\\n\\nOne time i saw one of the managers wearing a Chipotle shirt I thought was cool, so I asked if I could buy one. She said \\"Sure\\" and sold it to me. They actually rang me up, it was $10, and she charged me a chips & guac for a profit. For about $12.50 I got a nice long-sleeve t-shirt. If I wear it into other chipotles, the employees think I\'m a manager at another store and get nervous, which is hilarious but I try not to do it too often.\\n\\nCome on, it\'s cheap, fun, music\'s good, food\'s fresh and great, and the company has an Awesome attitude about their product. Just go already", "Your standard (amazing) Chipotle menu. The place itself is really clean and spacious. I always manage to find a table for myself. It\'s a perfect place to grab a quick bite after the movies. I recommend parking a little bit further (e.g. near the apartments or closer to Ralph\'s because the area directly in front of Chipotle is a death zone due to spontaneously appearing pedestrians and idiotic drivers.", "What can you say, it\'s a Chipotle and barring some sort of horrible gaffe by the staff, they\'re generally all the same. I find Chipotle to be the best of the \\"big burrito\\" style joints and drastically better than local fave Anna\'s, so I\'m pretty stoked to have this location (and the forthcoming one in Central Square) up and running.\\n\\nI thought the staff was stellar. They were incredibly friendly and speedy when I went in and they were answering all of the questions that the multitudes of Chipotle-newbies had for \'em.\\n\\nThe food was good, although I did humble the staff a bit as they had three different staff members attempt to wrap my burrito before giving up and busting out a second tortilla to keep it all packed inside.\\n\\nIf I had to make a complaint (and to be objective, I suppose I do) they could definitely use some more seating. It\'s a small location, but I think they could have set it up vastly different to maximize seating capacity.\\n\\nAs always, my second complaint would be that it\'s a $10 burrito and a drink runs you up to $12 pretty fast. It\'s generally worth every penny, but it\'s certainly not a \\"cheap\\" lunch option. \\n\\nUndoubtedly, they\'ll get plenty of my business in the future.", "I have to say, that even though they have good burritos, I\'m not a Chipotle fan (I\'m a Qdoba die hard)... \\n\\nNO nachos on the menu??  NO taco salad??  And I\'ve pretty much had a lousy experience with the line staff there every time... one time the guy was mumbling so badly I couldn\'t understand a damn thing he was asking me....  and you can tell the line workers REALLY HATE their job.  It\'s fine if you don\'t like your job, but do you have to radiate it so much while working and push it upon me when all I want is some nachos, which oh, by the way, you don\'t have?? \\n\\nIt\'s sort of like that episode of Seinfeld when the group goes to a different coffee shop for lunch, and Elaine wants a big salad, and the waitress looks at her like she\'s crazy... I mean, you have all the ingredients, just throw it all together in a bowl for me already, will ya?\\n\\nand why do they have to charge so much extra for a spoonful of guacamole on the burrito?!?!  I don\'t get it. \\n\\nI avoid chipotle now like the plague.", "looks great\\nhas beer\\nfast order process\\nsometimes crowded\\nkid friendly\\ngreat food\\n\\nthat\'s the summary\\n\\nchips are really nice and not uber oily. just dry. gives the illusion that they aren\'t that bad for you...which is pretty much everything in this place given the monster portion sizes\\n\\nall that said, it tastes great, is a cheap meal and as far as fast food goes, it\'s incredible and actual sidesteps the genre. i can\'t pick a better place to eat on the go\\n\\nmonster portion sizes...", "I always get dragged here....I did try it a couple of times, but once I had dinner with a friend and there was A FLY IN HER BURRITO. \\nThat\'s just gross. And this is coming from a girl who will gladly eat cheese off the floor. \\n\\nThe guys are nice, I guess, but no, I don\'t want flies with that.", "This Chipotle gets four stars for keeping me coming back for more. Where else can you wait in a place with a line 30 deep, and have your (large, advertised-as-sustainably-grown) meal in your hands 5-10 minutes later? The guys and gals in this place work hard and fast, and keep the floor and tables clean!I enjoy the patio dining.", "I\'m sure you\'ve tried Chipotle before, so the taste is always pretty standard. Before you read on, you should know i LOVE Chipotle and avoid walking down Telegraph to go home because I know I\'d be tempted soon as I see their logo. (Steak Burrito Bol w/ tortilla on the side: extra rice, no beans, corn, mild salsa, small bit of sour cream, cheese, lots of lettuce = amazing!) \\n\\nPortions: During the student rush, they sometimes skimp when they add all that noms chicken/steak/corn/rice. But the servers are always really friendly and will oblige if you ask for extra rice or lettuce, etc. \\n\\nOne thing you HAVE to try if you haven\'t already: SMOKED Chipotle sauce! I\'m not the biggest fan of spicy, but this makes the burrito so so tasty. If you don\'t see one lying around (*ahem to the people who steal them), ask the cashier and they always bring out a new one for you. \\n\\nThere aren\'t too many tables to sit and eat your food, so I usually take my food to go."]')

var condition = _.sample(['examples', 'full', 'selected']);
var showSuggs = condition !== 'examples';
$('.expzone').addClass('cond-'+(showSuggs ? 'suggs' : 'examples'));

var writingTA = document.querySelector('[name=writing]');
$('[name=condition]').val(condition);

var logEntries = [];
function log(evt) {
    logEntries.push(evt);
    $('[name=log]').val(JSON.stringify(logEntries));
}

function showHints(hints) {
    log({type: 'showHints', hints: hints});
    var box = document.querySelector('.suggs select');
    box.innerHTML = hints.map(x => "<option>"+x+"</option>").join('');
}

var prevNumFinishedSents = null;

$('.suggs select').on('change', function(evt) {
    evt.preventDefault();
    log({type: 'clickHint', hint: evt.target.value});
    writingTA.value += evt.target.value + ' ';
    evt.target.value = '';
    $(writingTA).focus();
    textUpdated();
    return false;
});

function countWords(str) {
    var matches = str.match(/\S+/g);
    return matches ? matches.length : 0;
}

function textUpdated() {
    var curText = writingTA.value;
    $('#wordcount').text(countWords(curText));
    var numFinishedSents = (curText.replace(/\.{3,}/, ' _ELLIPS_ ').match(/[\.\?\!]+/g) || []).length;
    if (numFinishedSents !== prevNumFinishedSents) {
        console.log(numFinishedSents);
        if (condition === 'selected') {
            showHints(getAppropriateHints(numFinishedSents, 10));
        }
    }
    prevNumFinishedSents = numFinishedSents;
}

$(writingTA).on('input', function(evt) {
    textUpdated();
});

function getAppropriateHints(numSents, max) {
    var hints = [];
    hintsData.forEach(function(group) {
        var meta = group[0], sents = group[1];
        if (meta === 'START' && numSents > 0) return;
        if (meta === 'EARLY' && numSents > 1) return;
        if (numSents < 2 && ['START', 'EARLY'].indexOf(meta) === -1) return;
        if (numSents < 5 && meta === "END") return;
        hints.push(_.sample(sents));
    });
    return _.shuffle(hints).slice(0, max);
}

if (condition === 'examples') {
    var ex = $('.examples');
    ex.empty();
    examplesData.forEach(function(example) {
        var elt = $("<div class='example'>");
        elt.text(example);
        ex.append(elt);
    });
} else if (condition === 'full') {
    showHints(hintsData.map(function(group) {
        var sents = group[1];
        return _.sample(sents);
    }));
}

textUpdated();
